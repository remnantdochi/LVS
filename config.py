"""Configuration dataclasses for the LVS simulation pipeline."""
from dataclasses import dataclass, field
from typing import Literal


@dataclass
class TxConfig:
    """Transmitter operating parameters."""

    fs: float = 5e6  # Sample rate in Hz
    chunk_size: int = 5000  # Samples per generated chunk - match to DMA buffer size
    center_freq: float = 457e3  # Nominal beacon carrier frequency
    freq_tolerance: float = 100.0  # ± tolerance in Hz
    pulse_length: float = 0.07  # Pulse ON duration in seconds
    pulse_period: float = 1.0  # Pulse repetition period in seconds
    pulse_period_tolerance: float = 0.3  # ± tolerance in seconds
    use_pulse_envelope: bool = False

    seed: int | None = None
    randomize: bool = False
    use_awgn: bool = True
    awgn_snr: float = 30.0  # dB


@dataclass
class AdcConfig:
    """MCU ADC sampling parameters."""
    mode: str = "subsample"  # "full" or "subsample"
    fs_full: float = 1e6
    fs_subsample: float = 18950


@dataclass
class RxConfig:
    """Receiver DSP parameters."""

    carrier_freq: float = 457e3
    pipeline_idx: int = 3 #[0 - nco mixer, 1 - cic filter, 2 - fir/iir filter, 3- fft detection]
    filter_type: Literal["fir", "iir"] = "fir"
    
    cic_stages: int = 3
    cic_decimation_full: int = 16
    cic_decimation_subsample: int = 1

    fir_taps: int = 127
    fir_cutoff_hz: float = 500
    fir_sample_full: float = 62500
    fir_sample_subsample: float = 18950

    fir_decimation_full: int = 6
    fir_decimation_subsample: int = 1
    fir_coefficients_full: tuple[float, ...] = (
        -0.0000000000,
        0.0000000979,
        0.0000011922,
        0.0000045330,
        0.0000114276,
        0.0000232310,
        0.0000413338,
        0.0000671516,
        0.0001021124,
        0.0001476445,
        0.0002051638,
        0.0002760608,
        0.0003616880,
        0.0004633470,
        0.0005822756,
        0.0007196359,
        0.0008765014,
        0.0010538463,
        0.0012525340,
        0.0014733067,
        0.0017167762,
        0.0019834147,
        0.0022735472,
        0.0025873449,
        0.0029248189,
        0.0032858164,
        0.0036700164,
        0.0040769283,
        0.0045058905,
        0.0049560708,
        0.0054264683,
        0.0059159161,
        0.0064230854,
        0.0069464915,
        0.0074845002,
        0.0080353356,
        0.0085970897,
        0.0091677319,
        0.0097451210,
        0.0103270168,
        0.0109110933,
        0.0114949526,
        0.0120761394,
        0.0126521560,
        0.0132204778,
        0.0137785694,
        0.0143239004,
        0.0148539620,
        0.0153662829,
        0.0158584456,
        0.0163281025,
        0.0167729907,
        0.0171909479,
        0.0175799260,
        0.0179380053,
        0.0182634075,
        0.0185545071,
        0.0188098430,
        0.0190281281,
        0.0192082581,
        0.0193493191,
        0.0194505936,
        0.0195115657,
        0.0195319243,
        0.0195115657,
        0.0194505936,
        0.0193493191,
        0.0192082581,
        0.0190281281,
        0.0188098430,
        0.0185545071,
        0.0182634075,
        0.0179380053,
        0.0175799260,
        0.0171909479,
        0.0167729907,
        0.0163281025,
        0.0158584456,
        0.0153662829,
        0.0148539620,
        0.0143239004,
        0.0137785694,
        0.0132204778,
        0.0126521560,
        0.0120761394,
        0.0114949526,
        0.0109110933,
        0.0103270168,
        0.0097451210,
        0.0091677319,
        0.0085970897,
        0.0080353356,
        0.0074845002,
        0.0069464915,
        0.0064230854,
        0.0059159161,
        0.0054264683,
        0.0049560708,
        0.0045058905,
        0.0040769283,
        0.0036700164,
        0.0032858164,
        0.0029248189,
        0.0025873449,
        0.0022735472,
        0.0019834147,
        0.0017167762,
        0.0014733067,
        0.0012525340,
        0.0010538463,
        0.0008765014,
        0.0007196359,
        0.0005822756,
        0.0004633470,
        0.0003616880,
        0.0002760608,
        0.0002051638,
        0.0001476445,
        0.0001021124,
        0.0000671516,
        0.0000413338,
        0.0000232310,
        0.0000114276,
        0.0000045330,
        0.0000011922,
        0.0000000979,
        -0.0000000000,
)

    fir_coefficients_subsample: tuple[float, ...] = (
        -0.0000000000,
        -0.0000024103,
        -0.0000082501,
        -0.0000148092,
        -0.0000187022,
        -0.0000161134,
        -0.0000030910,
        0.0000241233,
        0.0000687469,
        0.0001331113,
        0.0002183381,
        0.0003240571,
        0.0004481863,
        0.0005867905,
        0.0007340328,
        0.0008822309,
        0.0010220230,
        0.0011426466,
        0.0012323243,
        0.0012787496,
        0.0012696562,
        0.0011934533,
        0.0010399017,
        0.0008008050,
        0.0004706862,
        0.0000474180,
        -0.0004672222,
        -0.0010671047,
        -0.0017414311,
        -0.0024745754,
        -0.0032460986,
        -0.0040309506,
        -0.0047998641,
        -0.0055199392,
        -0.0061554100,
        -0.0066685760,
        -0.0070208749,
        -0.0071740666,
        -0.0070914924,
        -0.0067393689,
        -0.0060880735,
        -0.0051133759,
        -0.0037975705,
        -0.0021304667,
        -0.0001101968,
        0.0022561944,
        0.0049524063,
        0.0079528067,
        0.0112226374,
        0.0147185034,
        0.0183891410,
        0.0221764472,
        0.0260167483,
        0.0298422714,
        0.0335827795,
        0.0371673227,
        0.0405260527,
        0.0435920467,
        0.0463030831,
        0.0486033156,
        0.0504447903,
        0.0517887612,
        0.0526067579,
        0.0528813754,
        0.0526067579,
        0.0517887612,
        0.0504447903,
        0.0486033156,
        0.0463030831,
        0.0435920467,
        0.0405260527,
        0.0371673227,
        0.0335827795,
        0.0298422714,
        0.0260167483,
        0.0221764472,
        0.0183891410,
        0.0147185034,
        0.0112226374,
        0.0079528067,
        0.0049524063,
        0.0022561944,
        -0.0001101968,
        -0.0021304667,
        -0.0037975705,
        -0.0051133759,
        -0.0060880735,
        -0.0067393689,
        -0.0070914924,
        -0.0071740666,
        -0.0070208749,
        -0.0066685760,
        -0.0061554100,
        -0.0055199392,
        -0.0047998641,
        -0.0040309506,
        -0.0032460986,
        -0.0024745754,
        -0.0017414311,
        -0.0010671047,
        -0.0004672222,
        0.0000474180,
        0.0004706862,
        0.0008008050,
        0.0010399017,
        0.0011934533,
        0.0012696562,
        0.0012787496,
        0.0012323243,
        0.0011426466,
        0.0010220230,
        0.0008822309,
        0.0007340328,
        0.0005867905,
        0.0004481863,
        0.0003240571,
        0.0002183381,
        0.0001331113,
        0.0000687469,
        0.0000241233,
        -0.0000030910,
        -0.0000161134,
        -0.0000187022,
        -0.0000148092,
        -0.0000082501,
        -0.0000024103,
        -0.0000000000,
    )
    iir_order: int = 2
    iir_cutoff_hz: float = 20e3
    iir_sample_rate_hz: float = 62500.0
    iir_b_coefficients: tuple[float, ...] = (
        0.4347393483,
        0.8694786966,
        0.4347393483,
    )
    iir_a_coefficients: tuple[float, ...] = (
        1.0000000000,
        0.5193034092,
        0.2196539839,
    )
    iir_decimation_full: int = 6
    iir_decimation_subsample: int = 1

    fft_size_full: int = 1024
    fft_size_subsample: int = 1024
    fft_threshold_db: float = 8
    fft_min_magnitude: float = 1e-9



@dataclass
class SimulationConfig:
    """Top-level simulation control parameters."""

    tx: TxConfig = field(default_factory=TxConfig)
    adc: AdcConfig = field(default_factory=AdcConfig)
    rx: RxConfig = field(default_factory=RxConfig)

    duration: float = 0.5  # Total simulation time in seconds
    plot_enabled: bool = True
    plot_stages: tuple[str, ...] = ("tx", "adc", "rx")  # ("tx", "adc", "rx")
    time_scale: float = 1e3
