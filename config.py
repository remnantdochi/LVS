"""Configuration dataclasses for the LVS simulation pipeline."""
from dataclasses import dataclass, field
from typing import Literal


@dataclass
class TxConfig:
    """Transmitter operating parameters."""

    fs: float = 5e6  # Sample rate in Hz
    chunk_size: int = 5000  # Samples per generated chunk - match to DMA buffer size
    center_freq: float = 457e3  # Nominal beacon carrier frequency
    freq_tolerance: float = 100.0  # ± tolerance in Hz
    pulse_length: float = 0.07  # Pulse ON duration in seconds
    pulse_period: float = 1.0  # Pulse repetition period in seconds
    pulse_period_tolerance: float = 0.3  # ± tolerance in seconds
    use_pulse_envelope: bool = False

    seed: int | None = None
    randomize: bool = False
    use_awgn: bool = True
    awgn_snr: float = 30.0  # dB


@dataclass
class AdcConfig:
    """MCU ADC sampling parameters."""
    mode: str = "subsample"  # "full" or "subsample"
    fs_full: float = 1e6
    fs_subsample: float = 25000.0


@dataclass
class RxConfig:
    """Receiver DSP parameters."""

    carrier_freq: float = 457e3
    pipeline_idx: int = 3 #[0 - nco mixer, 1 - cic filter, 2 - fir/iir filter, 3- fft detection]
    filter_type: Literal["fir", "iir"] = "fir"
    
    cic_stages: int = 3
    cic_decimation_full: int = 16
    cic_decimation_subsample: int = 3

    fir_taps: int = 127
    fir_cutoff_hz: float = 500
    fir_sample_full: float = 1e6 / 16
    fir_sample_subsample: float = 25000.0 / 3

    fir_decimation_full: int = 6
    fir_decimation_subsample: int = 1
    fir_coefficients_full: tuple[float, ...] = (
        -0.0000000000,
        0.0000000979,
        0.0000011922,
        0.0000045330,
        0.0000114276,
        0.0000232310,
        0.0000413338,
        0.0000671516,
        0.0001021124,
        0.0001476445,
        0.0002051638,
        0.0002760608,
        0.0003616880,
        0.0004633470,
        0.0005822756,
        0.0007196359,
        0.0008765014,
        0.0010538463,
        0.0012525340,
        0.0014733067,
        0.0017167762,
        0.0019834147,
        0.0022735472,
        0.0025873449,
        0.0029248189,
        0.0032858164,
        0.0036700164,
        0.0040769283,
        0.0045058905,
        0.0049560708,
        0.0054264683,
        0.0059159161,
        0.0064230854,
        0.0069464915,
        0.0074845002,
        0.0080353356,
        0.0085970897,
        0.0091677319,
        0.0097451210,
        0.0103270168,
        0.0109110933,
        0.0114949526,
        0.0120761394,
        0.0126521560,
        0.0132204778,
        0.0137785694,
        0.0143239004,
        0.0148539620,
        0.0153662829,
        0.0158584456,
        0.0163281025,
        0.0167729907,
        0.0171909479,
        0.0175799260,
        0.0179380053,
        0.0182634075,
        0.0185545071,
        0.0188098430,
        0.0190281281,
        0.0192082581,
        0.0193493191,
        0.0194505936,
        0.0195115657,
        0.0195319243,
        0.0195115657,
        0.0194505936,
        0.0193493191,
        0.0192082581,
        0.0190281281,
        0.0188098430,
        0.0185545071,
        0.0182634075,
        0.0179380053,
        0.0175799260,
        0.0171909479,
        0.0167729907,
        0.0163281025,
        0.0158584456,
        0.0153662829,
        0.0148539620,
        0.0143239004,
        0.0137785694,
        0.0132204778,
        0.0126521560,
        0.0120761394,
        0.0114949526,
        0.0109110933,
        0.0103270168,
        0.0097451210,
        0.0091677319,
        0.0085970897,
        0.0080353356,
        0.0074845002,
        0.0069464915,
        0.0064230854,
        0.0059159161,
        0.0054264683,
        0.0049560708,
        0.0045058905,
        0.0040769283,
        0.0036700164,
        0.0032858164,
        0.0029248189,
        0.0025873449,
        0.0022735472,
        0.0019834147,
        0.0017167762,
        0.0014733067,
        0.0012525340,
        0.0010538463,
        0.0008765014,
        0.0007196359,
        0.0005822756,
        0.0004633470,
        0.0003616880,
        0.0002760608,
        0.0002051638,
        0.0001476445,
        0.0001021124,
        0.0000671516,
        0.0000413338,
        0.0000232310,
        0.0000114276,
        0.0000045330,
        0.0000011922,
        0.0000000979,
        -0.0000000000,
)

    fir_coefficients_subsample: tuple[float, ...] = (
        -0.0000000000,
        -0.0000031344,
        -0.0000109467,
        -0.0000174141,
        -0.0000133011,
        0.0000106348,
        0.0000597603,
        0.0001320615,
        0.0002161019,
        0.0002912955,
        0.0003308825,
        0.0003073766,
        0.0001996141,
        -0.0000000000,
        -0.0002797343,
        -0.0006059024,
        -0.0009245867,
        -0.0011682027,
        -0.0012664389,
        -0.0011601175,
        -0.0008156755,
        -0.0002374656,
        0.0005249509,
        0.0013768161,
        0.0021867577,
        0.0028037737,
        0.0030808675,
        0.0029020911,
        0.0022086623,
        0.0010193576,
        -0.0005592866,
        -0.0023362764,
        -0.0040544000,
        -0.0054224826,
        -0.0061582448,
        -0.0060361380,
        -0.0049329824,
        -0.0028636910,
        0.0000000000,
        0.0033330234,
        0.0066850485,
        0.0095319287,
        0.0113456092,
        0.0116742291,
        0.0102217459,
        0.0069153757,
        0.0019497545,
        -0.0042009748,
        -0.0108081826,
        -0.0169511212,
        -0.0216117004,
        -0.0237918660,
        -0.0226399645,
        -0.0175703007,
        -0.0083599620,
        0.0047909866,
        0.0212458247,
        0.0399683786,
        0.0596091278,
        0.0786319212,
        0.0954675656,
        0.1086767460,
        0.1171031153,
        0.1199982184,
        0.1171031153,
        0.1086767460,
        0.0954675656,
        0.0786319212,
        0.0596091278,
        0.0399683786,
        0.0212458247,
        0.0047909866,
        -0.0083599620,
        -0.0175703007,
        -0.0226399645,
        -0.0237918660,
        -0.0216117004,
        -0.0169511212,
        -0.0108081826,
        -0.0042009748,
        0.0019497545,
        0.0069153757,
        0.0102217459,
        0.0116742291,
        0.0113456092,
        0.0095319287,
        0.0066850485,
        0.0033330234,
        0.0000000000,
        -0.0028636910,
        -0.0049329824,
        -0.0060361380,
        -0.0061582448,
        -0.0054224826,
        -0.0040544000,
        -0.0023362764,
        -0.0005592866,
        0.0010193576,
        0.0022086623,
        0.0029020911,
        0.0030808675,
        0.0028037737,
        0.0021867577,
        0.0013768161,
        0.0005249509,
        -0.0002374656,
        -0.0008156755,
        -0.0011601175,
        -0.0012664389,
        -0.0011682027,
        -0.0009245867,
        -0.0006059024,
        -0.0002797343,
        -0.0000000000,
        0.0001996141,
        0.0003073766,
        0.0003308825,
        0.0002912955,
        0.0002161019,
        0.0001320615,
        0.0000597603,
        0.0000106348,
        -0.0000133011,
        -0.0000174141,
        -0.0000109467,
        -0.0000031344,
        -0.0000000000,
    )
    iir_order: int = 2
    iir_cutoff_hz: float = 20e3
    iir_sample_rate_hz: float = 62500.0
    iir_b_coefficients: tuple[float, ...] = (
        0.4347393483,
        0.8694786966,
        0.4347393483,
    )
    iir_a_coefficients: tuple[float, ...] = (
        1.0000000000,
        0.5193034092,
        0.2196539839,
    )
    iir_decimation_full: int = 6
    iir_decimation_subsample: int = 1

    fft_size_full: int = 1024
    fft_size_subsample: int = 1024
    fft_threshold_db: float = 8
    fft_min_magnitude: float = 1e-9



@dataclass
class SimulationConfig:
    """Top-level simulation control parameters."""

    tx: TxConfig = field(default_factory=TxConfig)
    adc: AdcConfig = field(default_factory=AdcConfig)
    rx: RxConfig = field(default_factory=RxConfig)

    duration: float = 0.5  # Total simulation time in seconds
    plot_enabled: bool = True
    plot_stages: tuple[str, ...] = ("tx", "rx")  # ("tx", "adc", "rx")
    time_scale: float = 1e3
